# 百度网盘 OAuth 快速开始

## ✅ 已完成的配置

1. ✅ **密钥已配置到 `.env` 文件**
   - AppKey (Client ID): `V0HWbaeKaFlqVPbGKcb5rizvRKJnMyHk`
   - SecretKey (Client Secret): `4CeEL1iX5rAvvaH6kKDZ3DcxjnQZ5N1u`

2. ✅ **代码已实现**
   - OAuth 授权流程
   - Token 刷新机制
   - 用户信息获取
   - 存储配额查询

## ⚠️ 需要完成的配置

### 重要：配置授权回调地址

应用使用随机端口（49152-65535）接收 OAuth 回调，您需要在百度网盘开放平台配置回调地址。

**步骤：**

1. 访问 [百度网盘开放平台控制台](https://pan.baidu.com/union/console/applist)
2. 找到您的应用（AppKey: `V0HWbaeKaFlqVPbGKcb5rizvRKJnMyHk`）
3. 进入应用设置 → **授权回调地址** 或 **Redirect URI**
4. 根据百度网盘的支持情况，选择以下方式之一：

#### 方式 A：配置通配符（如果支持）
```
http://127.0.0.1:*
```

#### 方式 B：配置固定端口（推荐）
如果百度网盘不支持通配符，可以修改代码使用固定端口。联系开发者或修改代码中的端口范围。

#### 方式 C：配置多个端口
如果必须配置具体端口，可以先运行一次应用，查看日志中的实际端口，然后配置该端口：
```
http://127.0.0.1:49152
```

## 🚀 测试步骤

1. **重新编译应用**（确保环境变量已加载）
   ```bash
   cd apps/desktop
   npm run tauri build
   # 或开发模式
   npm run tauri dev
   ```

2. **打开应用并测试**
   - 进入"云存储设置"
   - 选择"百度网盘"
   - 点击"使用百度网盘登录"
   - 在浏览器中完成授权
   - 检查是否成功获取用户信息

3. **查看日志**
   - 如果授权失败，查看应用日志中的错误信息
   - 特别注意回调地址相关的错误

## 🔍 故障排查

### 问题：redirect_uri 不匹配

**原因：** 百度网盘开放平台中配置的回调地址与应用实际使用的地址不一致

**解决：**
1. 查看应用日志，找到实际使用的回调地址（例如：`http://127.0.0.1:49152`）
2. 在百度网盘开放平台中配置相同的回调地址
3. 如果使用随机端口，考虑使用固定端口或联系百度网盘技术支持

### 问题：授权页面无法打开

**原因：** 浏览器无法打开授权 URL

**解决：**
1. 检查网络连接
2. 手动访问授权 URL（查看日志中的授权 URL）
3. 检查防火墙设置

### 问题：Token 获取失败

**原因：** 授权码交换 token 时出错

**解决：**
1. 检查 `.env` 文件中的密钥是否正确
2. 确认密钥没有多余的空格或换行
3. 查看日志中的详细错误信息

## 📝 下一步

配置完成后，您可以：
1. 测试完整的授权流程
2. 验证用户信息获取
3. 测试存储配额查询
4. 测试文件上传功能（如果已实现）

## 📚 相关文档

- [完整配置指南](./BAIDU_NETDISK_SETUP.md)
- [百度网盘开放平台文档](https://pan.baidu.com/union/doc/)
- [OAuth 接入指南](https://openauth.baidu.com/doc/doc.html)
